>     fi
> }
>
> # Emit lines
> start_ms=$(date +%s%3N)
> end_ms=$((start_ms + 31000))
> line_count=0
>
> while [ $(date +%s%3N) -lt $end_ms ]; do
>     # Random sleep between 18-24ms
>     sleep $(awk 'BEGIN{srand(); print 0.018 + rand()*0.006}')
>
>     # Random user
>     user="${users[RANDOM % ${#users[@]}]}"
>     session="$(openssl rand -hex 3)"
>     ts=$(date +%s%3N)
>     admin="false"; if [ $((RANDOM % 5)) -eq 0 ]; then admin="true"; fi
>     meta="{\"admin\": $admin}"
>
>     # Randomly make malformed (~7.5%)
>     if [ $((RANDOM % 100)) -lt 8 ]; then
>         line="{\"ts\": $ts, \"session\": \"$session\", \"user\": \"$user\", \"meta\": {\"admin\": $admin}"
>     else
>         line="{\"ts\": $ts, \"session\": \"$session\", \"user\": \"$user\", \"meta\": {\"admin\": $admin}}"
>     fi
>
>     # Write to stdout (FIFO) and log
>     echo "$line"
>     if [ -f "$LOGFILE" ] && [ $(stat -c %s "$LOGFILE") -gt $MAX_SIZE ]; then
>         rotate_log "$LOGFILE" 1
>     fi
>     echo "$line" >> "$LOGFILE"
>
>     line_count=$((line_count + 1))
> done
>
> echo "Produced $line_count lines" >&2
> EOF
root@8af36de92545:/app# chmod +x producer.sh; tmux wait -S done
root@8af36de92545:/app#
